<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ò–Ω—Ç–µ—Ä–≤—å—é –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–æ–ª–µ–π ‚Äî –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ—Ç—á—ë—Ç–∞</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    :root { --card: #0f172a; --ink: #e5e7eb; --muted:#9ca3af; --accent:#22d3ee; }
    html, body { background:#0b1020; color:var(--ink); }
    .card { background:var(--card); border-radius:1rem; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .chip { padding:.1rem .5rem; border:1px solid rgba(255,255,255,.1); border-radius:.5rem; font-size:.75rem; }
    .btn { background:#111827; border:1px solid rgba(255,255,255,.12); border-radius:.75rem; padding:.55rem .9rem; }
    .btn:hover { border-color:rgba(255,255,255,.25); }
    .btn-primary { background:linear-gradient(135deg,#22d3ee,#4ade80); color:#0b1020; font-weight:700 }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:1rem; }
    @media (max-width: 900px){ .grid-2{ grid-template-columns: 1fr; } }
    textarea { min-height: 110px; }
    .kbd{border:1px solid rgba(255,255,255,.2); border-bottom-width:2px; border-radius:.5rem; padding:.05rem .4rem; font-weight:700; font-size:.75rem}
    .id-tag{font-size:.7rem; color:var(--muted)}
    .section-title{display:flex;align-items:center;gap:.6rem}
  </style>
</head>
<body>
  <div class="max-w-6xl mx-auto p-4 md:p-6">
    <header class="flex flex-col md:flex-row md:items-end md:justify-between gap-3 mb-6">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold">–ò–Ω—Ç–µ—Ä–≤—å—é –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–æ–ª–µ–π</h1>
        <p class="text-sm text-gray-300">–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ñ–∏—Å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤—å—é. –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON / Markdown / YAML. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.</p>
      </div>
      <div class="flex flex-wrap gap-2">
        <button class="btn" onclick="saveDraft()" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ"><span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn" onclick="loadDraft()" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫"><span>üìÇ</span> –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        <label class="btn cursor-pointer" title="–ò–º–ø–æ—Ä—Ç JSON">
          üì• –ò–º–ø–æ—Ä—Ç JSON
          <input id="importFile" type="file" accept="application/json" class="hidden" onchange="importJSON(event)" />
        </label>
        <button class="btn btn-primary" onclick="exportAll()" title="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç</button>
        <button class="btn" onclick="window.print()" title="–ü–µ—á–∞—Ç—å / PDF">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
      </div>
    </header>

    <!-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Å–æ–≥–ª–∞—Å–∏–µ -->
    <section class="card p-5 md:p-6 mb-5" id="sec-meta">
      <div class="section-title"><h2 class="text-xl font-semibold">1) –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Å–æ–≥–ª–∞—Å–∏–µ</h2><span class="chip">–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span></div>
      <div class="grid-2 mt-3">
        <div>
          <label class="block text-sm text-gray-300">–ö–æ–º–ø–∞–Ω–∏—è</label>
          <input id="company" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–û–û–û –ü—Ä–∏–º–µ—Ä"/>
        </div>
        <div>
          <label class="block text-sm text-gray-300">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ / –ö–æ–º–∞–Ω–¥–∞</label>
          <input id="dept" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂"/>
        </div>
        <div>
          <label class="block text-sm text-gray-300">–†–æ–ª—å / –î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
          <input id="role" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–ê–∫–∫–∞—É–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä"/>
        </div>
        <div>
          <label class="block text-sm text-gray-300">–°–æ—Ç—Ä—É–¥–Ω–∏–∫ (–ø—Å–µ–≤–¥–æ–Ω–∏–º –¥–æ–ø—É—Å—Ç–∏–º)</label>
          <input id="employee" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–ò–≤–∞–Ω –ò."/>
        </div>
        <div>
          <label class="block text-sm text-gray-300">–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä</label>
          <input id="interviewer" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–û–ª–µ–≥ –¢."/>
        </div>
        <div>
          <label class="block text-sm text-gray-300">–î–∞—Ç–∞</label>
          <input id="date" type="date" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2"/>
        </div>
      </div>
      <div class="mt-3 flex flex-col gap-2">
        <label class="inline-flex items-center gap-2"><input id="consentRecord" type="checkbox" class="form-checkbox"/> <span>–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –∑–∞–ø–∏—Å—å —Ç–µ–∫—Å—Ç–∞ –∏–Ω—Ç–µ—Ä–≤—å—é</span></label>
        <label class="inline-flex items-center gap-2"><input id="consentPII" type="checkbox" class="form-checkbox"/> <span>–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</span></label>
        <label class="inline-flex items-center gap-2"><input id="redact" type="checkbox" class="form-checkbox" checked/> <span>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å PII –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ (e‚Äëmail, —Ç–µ–ª–µ—Ñ–æ–Ω—ã)</span></label>
      </div>
    </section>

    <!-- –ö–∞–Ω–∞–ª—ã / –ò—Å—Ç–æ—á–Ω–∏–∫–∏ -->
    <section class="card p-5 md:p-6 mb-5" id="sec-channels">
      <div class="section-title"><h2 class="text-xl font-semibold">2) –ö–∞–Ω–∞–ª—ã –∏ —Å–∏—Å—Ç–µ–º—ã</h2><span class="chip">–≤—Ö–æ–¥—ã</span></div>
      <p class="text-sm text-gray-300 mt-1">–û—Ç–∫—É–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é? –û—Ç–º–µ—Ç—å—Ç–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏.</p>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-3" id="channelsBox"></div>
      <div class="mt-3 flex gap-2">
        <input id="customChannel" class="flex-1 bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–î—Ä—É–≥–æ–µ‚Ä¶"/>
        <button class="btn" onclick="addCustomChannel()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </section>

    <!-- –í—Ö–æ–¥—ã -->
    <section class="card p-5 md:p-6 mb-5" id="sec-inputs">
      <div class="section-title"><h2 class="text-xl font-semibold">3) –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2><span class="chip">—Ç–∞–±–ª–∏—Ü–∞</span></div>
      <p class="text-sm text-gray-300 mt-1">–ß—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Ä–∞–±–æ—Ç—É: —Ñ–æ—Ä–º–∞—Ç, —á–∞—Å—Ç–æ—Ç–∞, —Å–∏—Å—Ç–µ–º–∞‚Äë–∏—Å—Ç–æ—á–Ω–∏–∫.</p>
      <table class="w-full text-sm mt-3" id="tbl-inputs">
        <thead class="text-left text-gray-300"><tr><th class="py-1">–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ò—Å—Ç–æ—á–Ω–∏–∫/–°–∏—Å—Ç–µ–º–∞</th><th>–§–æ—Ä–º–∞—Ç</th><th>–ß–∞—Å—Ç–æ—Ç–∞</th><th></th></tr></thead>
        <tbody id="inputsBody"></tbody>
      </table>
      <div class="id-tag mt-1">table-id: timebox-inputs</div>
      <button class="btn mt-3" onclick="addRow('inputs')">‚ûï –°—Ç—Ä–æ–∫–∞</button>
    </section>

    <!-- –í—ã—Ö–æ–¥—ã -->
    <section class="card p-5 md:p-6 mb-5" id="sec-outputs">
      <div class="section-title"><h2 class="text-xl font-semibold">4) –í—ã—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</h2><span class="chip">—Ç–∞–±–ª–∏—Ü–∞</span></div>
      <p class="text-sm text-gray-300 mt-1">–ß—Ç–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏ –∫—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å.</p>
      <table class="w-full text-sm mt-3" id="tbl-outputs">
        <thead class="text-left text-gray-300"><tr><th class="py-1">–ê—Ä—Ç–µ—Ñ–∞–∫—Ç</th><th>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å</th><th>–§–æ—Ä–º–∞—Ç/–®–∞–±–ª–æ–Ω</th><th>–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è</th><th></th></tr></thead>
        <tbody id="outputsBody"></tbody>
      </table>
      <div class="id-tag mt-1">table-id: deliverables-outputs</div>
      <button class="btn mt-3" onclick="addRow('outputs')">‚ûï –°—Ç—Ä–æ–∫–∞</button>
    </section>

    <!-- –ó–∞–¥–∞—á–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã -->
    <section class="card p-5 md:p-6 mb-5" id="sec-tasks">
      <div class="section-title"><h2 class="text-xl font-semibold">5) –ó–∞–¥–∞—á–∏ –∏ –ø–æ—à–∞–≥–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã</h2><span class="chip">–º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–µ</span></div>
      <p class="text-sm text-gray-300 mt-1">–î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏. –î–ª—è –∫–∞–∂–¥–æ–π ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä, —à–∞–≥–∏, —Ä–∞–∑–≤–∏–ª–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è.</p>
      <div id="tasksBox" class="flex flex-col gap-3 mt-3"></div>
      <button class="btn mt-2" onclick="addTask()">‚ûï –ó–∞–¥–∞—á–∞</button>
      <div class="flex items-center gap-2 mt-4">
        <select id="diagramTaskIdx" class="bg-gray-900 border border-gray-700 rounded-lg p-2">
          <option value="">(–≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã)</option>
        </select>
        <button class="btn" onclick="buildDiagram()">üìà –î–∏–∞–≥—Ä–∞–º–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Mermaid)</button>
      </div>
      <div id="diagram" class="mt-3 card p-3 overflow-auto"></div>
      <div class="id-tag">genid: mermaid-main-01</div>
    </section>

    <!-- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è / RACI -->
    <section class="card p-5 md:p-6 mb-5" id="sec-raci">
      <div class="section-title"><h2 class="text-xl font-semibold">6) –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ RACI</h2><span class="chip">—Ç–∞–±–ª–∏—Ü–∞</span></div>
      <table class="w-full text-sm mt-3" id="tbl-raci">
        <thead class="text-left text-gray-300"><tr><th class="py-1">–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç (–ª—é–¥–∏/—Å–∏—Å—Ç–µ–º—ã)</th><th>–¢–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</th><th>R/A/C/I</th><th>–ö–∞–Ω–∞–ª</th><th></th></tr></thead>
        <tbody id="raciBody"></tbody>
      </table>
      <div class="id-tag mt-1">table-id: raci-matrix</div>
      <button class="btn mt-3" onclick="addRow('raci')">‚ûï –°—Ç—Ä–æ–∫–∞</button>
    </section>

    <!-- –í—Ä–µ–º—è –∏ —á–∞—Å—Ç–æ—Ç–∞ -->
    <section class="card p-5 md:p-6 mb-5" id="sec-time">
      <div class="section-title"><h2 class="text-xl font-semibold">7) –¢–∞–π–º-–∞—É–¥–∏—Ç</h2><span class="chip">—Ç–∞–±–ª–∏—Ü–∞</span></div>
      <p class="text-sm text-gray-300">–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —É—Ö–æ–¥–∏—Ç –Ω–∞ –∑–∞–¥–∞—á–∏? –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.</p>
      <table class="w-full text-sm mt-3" id="tbl-time">
        <thead class="text-left text-gray-300"><tr><th class="py-1">–ó–∞–¥–∞—á–∞</th><th>–ß–∞—Å—Ç–æ—Ç–∞</th><th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)</th><th>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ–º–æ—Å—Ç—å (0‚Äì100)</th><th></th></tr></thead>
        <tbody id="timeBody"></tbody>
      </table>
      <div class="id-tag mt-1">table-id: time-audit</div>
      <div class="mt-3 text-sm">–í—Å–µ–≥–æ –º–∏–Ω—É—Ç/–Ω–µ–¥–µ–ª—è: <span id="timeTotal" class="font-bold">0</span></div>
      <button class="btn mt-3" onclick="addRow('time')">‚ûï –°—Ç—Ä–æ–∫–∞</button>
    </section>

    <!-- –ü—Ä–∞–≤–∏–ª–∞, —Ä–∏—Å–∫–∏, –º–µ—Ç—Ä–∏–∫–∏ -->
    <section class="card p-5 md:p-6 mb-5" id="sec-rules">
      <div class="grid-2 gap-3">
        <div>
          <div class="section-title"><h2 class="text-xl font-semibold">8) –ë–∏–∑–Ω–µ—Å‚Äë–ø—Ä–∞–≤–∏–ª–∞ –∏ –ø–æ–ª–∏—Ç–∏–∫–∏</h2></div>
          <textarea id="rules" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏, SLA, —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π, —Ñ–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–æ–≤‚Ä¶"></textarea>
        </div>
        <div>
          <div class="section-title"><h2 class="text-xl font-semibold">9) –†–∏—Å–∫–∏, –æ—à–∏–±–∫–∏, –∏—Å–∫–ª—é—á–µ–Ω–∏—è</h2></div>
          <textarea id="risks" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–¢–∏–ø–æ–≤—ã–µ —Å–±–æ–∏, —Ä—É—á–Ω—ã–µ –æ–±—Ö–æ–¥—ã, —Ç–æ—á–∫–∏ —ç—Å–∫–∞–ª–∞—Ü–∏–∏‚Ä¶"></textarea>
        </div>
      </div>
      <div class="grid-2 gap-3 mt-3">
        <div>
          <div class="section-title"><h2 class="text-xl font-semibold">10) –ú–µ—Ç—Ä–∏–∫–∏ / KPI</h2></div>
          <textarea id="kpis" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, –∫–æ–Ω–≤–µ—Ä—Å–∏—è, —Ç–æ—á–Ω–æ—Å—Ç—å, NPS‚Ä¶"></textarea>
        </div>
        <div>
          <div class="section-title"><h2 class="text-xl font-semibold">11) –î–æ—Å—Ç—É–ø—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2></div>
          <textarea id="security" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–†–æ–ª–∏, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, —Ä–µ—Ç–µ–Ω—Ü–∏—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ (GDPR)‚Ä¶"></textarea>
        </div>
      </div>
    </section>

    <!-- –î–µ–Ω—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ / –ø—Ä–∏–º–µ—Ä—ã -->
    <section class="card p-5 md:p-6 mb-5" id="sec-day">
      <div class="grid-2 gap-3">
        <div>
          <div class="section-title"><h2 class="text-xl font-semibold">12) –î–µ–Ω—å –∏–∑ –∂–∏–∑–Ω–∏ (—Ç–∞–π–º–ª–∞–π–Ω)</h2></div>
          <textarea id="day" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è —Ç–∏–ø–∏—á–Ω–æ–≥–æ –¥–Ω—è: 09:00 –ø—Ä–æ–≤–µ—Ä–∫–∞ CRM ‚Üí 09:30 –æ—Ç–≤–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞–º‚Ä¶"></textarea>
        </div>
        <div>
          <div class="section-title"><h2 class="text-xl font-semibold">13) –ù–µ–¥–∞–≤–Ω–∏–µ 5 –∫–µ–π—Å–æ–≤</h2></div>
          <textarea id="cases" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–¥–∞—á, –∑–∞—á–µ–º, –∫–∞–∫ —Ä–µ—à–∞–ª–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç‚Ä¶"></textarea>
        </div>
      </div>
    </section>

    <!-- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã -->
    <section class="card p-5 md:p-6 mb-6" id="sec-auto">
      <div class="grid-2 gap-3">
        <div>
          <div class="section-title"><h2 class="text-xl font-semibold">14) –ò–¥–µ–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏</h2></div>
          <textarea id="automation" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="RPA, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, AI‚Äë–∫–æ–ø–∏–ª–æ—Ç—ã, —à–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤, –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ‚Ä¶"></textarea>
        </div>
        <div>
          <div class="section-title"><h2 class="text-xl font-semibold">15) –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –æ—Ü–µ–Ω–∫–∞</h2></div>
          <textarea id="priorities" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2" placeholder="–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –æ–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç‚Ä¶"></textarea>
        </div>
      </div>
      <div class="mt-4 flex flex-wrap gap-2">
        <button class="btn" onclick="previewMarkdown()">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞</button>
        <button class="btn btn-primary" onclick="exportAll()">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç JSON / MD / YAML</button>
      </div>
    </section>

    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞ -->
    <section class="card p-5 md:p-6 mb-10 hidden" id="sec-preview">
      <div class="section-title"><h2 class="text-xl font-semibold">üìÑ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä Markdown‚Äë–æ—Ç—á—ë—Ç–∞</h2><span class="chip">read‚Äëonly</span></div>
      <pre id="mdPreview" class="mt-3 whitespace-pre-wrap text-sm"></pre>
    </section>

    <footer class="text-xs text-gray-400 mb-8">
      –ü–æ–¥—Å–∫–∞–∑–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <span class="kbd">Tab</span> / <span class="kbd">Shift+Tab</span> –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞ –ø–æ –ø–æ–ª—è–º. –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç –ø–æ–¥–ø–∏—Å—å –≤–∏–¥–∞ <span class="chip">table-id</span>, –¥–∏–∞–≥—Ä–∞–º–º–∞ ‚Äî <span class="chip">genid</span>.
    </footer>
  </div>

  <script>
    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Mermaid ---
    mermaid.initialize({ startOnLoad: false, theme: 'dark' });

    // --- –ù–∞—á–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã ---
    const defaultChannels = ['Email','CRM','ERP','Slack/Teams','–¢–µ–ª–µ—Ñ–æ–Ω','Zoom/Meet','SharePoint/Drive','Git/Code','API','–§–æ—Ä–º—ã —Å–∞–π—Ç–∞','–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö','1C','Ticketing/Jira','Calendars','Paper'];

    const SKEY = 'interviewDraft-v1';

    function qs(id){ return document.getElementById(id); }

    function addCustomChannel(){
      const val = qs('customChannel').value.trim();
      if(!val) return; addChannelChip(val); qs('customChannel').value='';
    }

    function addChannelChip(name, checked=false){
      const box = qs('channelsBox');
      const id = 'chan-' + name.toLowerCase().replace(/[^a-z0-9]+/gi,'-');
      const wrap = document.createElement('label');
      wrap.className = 'inline-flex items-center gap-2 bg-gray-900 border border-gray-700 rounded-lg px-3 py-2';
      wrap.innerHTML = `<input type="checkbox" class="form-checkbox" id="${id}" ${checked?'checked':''}/> <span>${name}</span>`;
      wrap.dataset.name = name;
      box.appendChild(wrap);
    }

    // –¢–∞–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
    function addRow(kind, data={}){
      if(kind==='inputs'){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.name||''}"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.source||''}"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.format||''}"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.freq||''}"></td>
                        <td><button class="btn" onclick="this.closest('tr').remove()">‚úñ</button></td>`;
        qs('inputsBody').appendChild(tr);
      }
      if(kind==='outputs'){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.art||''}"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.consumer||''}"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.format||''}"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.store||''}"></td>
                        <td><button class="btn" onclick="this.closest('tr').remove()">‚úñ</button></td>`;
        qs('outputsBody').appendChild(tr);
      }
      if(kind==='raci'){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.party||''}"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.type||''}"></td>
                        <td><select class="w-full bg-gray-900 border border-gray-700 rounded p-1">
                              <option ${data.raci==='R'?'selected':''}>R</option>
                              <option ${data.raci==='A'?'selected':''}>A</option>
                              <option ${data.raci==='C'?'selected':''}>C</option>
                              <option ${data.raci==='I'?'selected':''}>I</option>
                            </select></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1" value="${data.channel||''}"></td>
                        <td><button class="btn" onclick="this.closest('tr').remove()">‚úñ</button></td>`;
        qs('raciBody').appendChild(tr);
      }
      if(kind==='time'){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1 taskname" value="${data.task||''}"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1 freq" value="${data.freq||''}" placeholder="–µ–∂–µ–¥–Ω–µ–≤–Ω–æ/–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ‚Ä¶"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1 mins" type="number" value="${data.mins||0}" min="0"></td>
                        <td><input class="w-full bg-gray-900 border border-gray-700 rounded p-1 score" type="number" value="${data.score||0}" min="0" max="100"></td>
                        <td><button class="btn" onclick="this.closest('tr').remove(); recalcTime()">‚úñ</button></td>`;
        qs('timeBody').appendChild(tr);
        tr.querySelector('.mins').addEventListener('input', recalcTime);
      }
    }

    // –ó–∞–¥–∞—á–∏
    let taskCount = 0;
    function addTask(data={}){
      const idx = taskCount++;
      const wrap = document.createElement('div');
      wrap.className = 'card p-4';
      wrap.innerHTML = `
        <div class="flex justify-between items-center">
          <div class="font-semibold">–ó–∞–¥–∞—á–∞ #${idx+1}</div>
          <div class="flex gap-2">
            <button class="btn" onclick="this.closest('.card').remove(); rebuildDiagramSelector()">‚úñ –£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
        <div class="grid-2 gap-3 mt-2">
          <div>
            <label class="text-sm text-gray-300">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input class="w-full bg-gray-900 border border-gray-700 rounded p-2 task-title" value="${data.title||''}">
          </div>
          <div>
            <label class="text-sm text-gray-300">–¢—Ä–∏–≥–≥–µ—Ä</label>
            <input class="w-full bg-gray-900 border border-gray-700 rounded p-2 task-trigger" value="${data.trigger||''}" placeholder="–ü–æ—Å—Ç—É–ø–∏–ª –∑–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞ / —Å—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è‚Ä¶">
          </div>
        </div>
        <div class="grid-2 gap-3 mt-2">
          <div>
            <label class="text-sm text-gray-300">–®–∞–≥–∏ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
            <textarea class="w-full bg-gray-900 border border-gray-700 rounded p-2 task-steps" placeholder="1. –û—Ç–∫—Ä—ã—Ç—å CRM\n2. –ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞‚Ä¶">${data.steps||''}</textarea>
          </div>
          <div>
            <label class="text-sm text-gray-300">–†–∞–∑–≤–∏–ª–∫–∏ / –†–µ—à–µ–Ω–∏—è</label>
            <textarea class="w-full bg-gray-900 border border-gray-700 rounded p-2 task-decisions" placeholder="–ï—Å–ª–∏ A ‚Äî –¥–µ–ª–∞–µ–º X, –∏–Ω–∞—á–µ Y">${data.decisions||''}</textarea>
          </div>
        </div>
        <div class="grid-2 gap-3 mt-2">
          <div>
            <label class="text-sm text-gray-300">–ò—Å–∫–ª—é—á–µ–Ω–∏—è / –û—à–∏–±–∫–∏</label>
            <textarea class="w-full bg-gray-900 border border-gray-700 rounded p-2 task-exc" placeholder="–ß—Ç–æ –¥–µ–ª–∞–µ–º –ø—Ä–∏ —Å–±–æ—è—Ö?">${data.exc||''}</textarea>
          </div>
          <div>
            <label class="text-sm text-gray-300">SLA / –°—Ä–æ–∫–∏</label>
            <input class="w-full bg-gray-900 border border-gray-700 rounded p-2 task-sla" value="${data.sla||''}">
          </div>
        </div>
      `;
      qs('tasksBox').appendChild(wrap);
      rebuildDiagramSelector();
    }

    function rebuildDiagramSelector(){
      const sel = qs('diagramTaskIdx');
      sel.innerHTML = '<option value="">(–≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã)</option>';
      const cards = [...qs('tasksBox').querySelectorAll('.card')];
      cards.forEach((c,i)=>{
        const title = c.querySelector('.task-title')?.value||`–ó–∞–¥–∞—á–∞ ${i+1}`;
        const opt = document.createElement('option');
        opt.value = i; opt.textContent = `${i+1}) ${title}`; sel.appendChild(opt);
      });
    }

    function buildDiagram(){
      const idx = parseInt(qs('diagramTaskIdx').value);
      if(isNaN(idx)) { qs('diagram').innerHTML = '<div class="text-sm text-red-300">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É.</div>'; return; }
      const card = qs('tasksBox').querySelectorAll('.card')[idx];
      const title = card.querySelector('.task-title').value || `–ó–∞–¥–∞—á–∞ ${idx+1}`;
      const steps = (card.querySelector('.task-steps').value||'').split(/\n+/).map(s=>s.replace(/^\d+\.\s*/,'').trim()).filter(Boolean);
      const decisions = (card.querySelector('.task-decisions').value||'').split(/\n+/).filter(Boolean);

      let flow = `flowchart TD\nA([${escapeMermaid(title)}])`;
      let prev = 'A';
      steps.forEach((s, i)=>{
        const id = 'S'+i; flow += `\n${id}([${escapeMermaid(s)}])`; flow += `\n${prev}-->${id}`; prev=id;
      });
      decisions.forEach((d, i)=>{
        const id = 'D'+i; flow += `\n${id}{${escapeMermaid(d)}}`; flow += `\n${prev}-->${id}`; prev=id;
      });
      flow += '\n';

      qs('diagram').innerHTML = `<div class="mermaid">${flow}</div>`;
      mermaid.run({ nodes: [qs('diagram')] });
    }

    function escapeMermaid(s){ return s.replace(/[\[\]{}()<>]/g,'').replace(/"/g,'\"'); }

    function collectTable(tbody){
      const rows = [...tbody.querySelectorAll('tr')];
      return rows.map(tr=>{
        const inputs = [...tr.querySelectorAll('input,select')];
        return inputs.map(i=>i.value);
      });
    }

    function recalcTime(){
      const mins = [...qs('timeBody').querySelectorAll('.mins')].map(i=>parseInt(i.value||0)||0);
      const total = mins.reduce((a,b)=>a+b,0);
      qs('timeTotal').textContent = total;
    }

    function redactPII(text){
      if(!qs('redact').checked) return text;
      // e‚Äëmail
      text = text.replace(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi,'[redacted-email]');
      // —Ç–µ–ª–µ—Ñ–æ–Ω—ã (–ø—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞)
      text = text.replace(/\+?\d[\d\s().-]{6,}\d/g,'[redacted-phone]');
      return text;
    }

    function gather(){
      const channels = [...qs('channelsBox').querySelectorAll('label')]
        .filter(l=>l.querySelector('input').checked).map(l=>l.dataset.name);

      const inputs = collectTable(qs('inputsBody')).map(r=>({name:r[0], source:r[1], format:r[2], freq:r[3]}));
      const outputs = collectTable(qs('outputsBody')).map(r=>({art:r[0], consumer:r[1], format:r[2], store:r[3]}));
      const raci = collectTable(qs('raciBody')).map(r=>({party:r[0], type:r[1], raci:r[2], channel:r[3]}));
      const time = collectTable(qs('timeBody')).map(r=>({task:r[0], freq:r[1], mins:Number(r[2]||0), score:Number(r[3]||0)}));

      const tasks = [...qs('tasksBox').querySelectorAll('.card')].map(c=>({
        title: c.querySelector('.task-title').value,
        trigger: c.querySelector('.task-trigger').value,
        steps: (c.querySelector('.task-steps').value||'').split(/\n+/).filter(Boolean),
        decisions: (c.querySelector('.task-decisions').value||'').split(/\n+/).filter(Boolean),
        exceptions: c.querySelector('.task-exc').value,
        sla: c.querySelector('.task-sla').value,
      }));

      const data = {
        meta: {
          company: qs('company').value,
          dept: qs('dept').value,
          role: qs('role').value,
          employee: qs('employee').value,
          interviewer: qs('interviewer').value,
          date: qs('date').value,
          consentRecord: qs('consentRecord').checked,
          consentPII: qs('consentPII').checked,
          redact: qs('redact').checked,
        },
        channels, inputs, outputs, tasks, raci, time,
        rules: qs('rules').value,
        risks: qs('risks').value,
        kpis: qs('kpis').value,
        security: qs('security').value,
        day: qs('day').value,
        cases: qs('cases').value,
        automation: qs('automation').value,
        priorities: qs('priorities').value,
      };

      // –†–µ–¥–∞–∫—Ü–∏—è PII –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—è—Ö
      ['rules','risks','kpis','security','day','cases','automation','priorities'].forEach(k=>{ data[k] = redactPII(data[k]); });
      data.tasks.forEach(t=>{ t.exceptions = redactPII(t.exceptions||''); t.steps = t.steps.map(s=>redactPII(s)); t.decisions = t.decisions.map(d=>redactPII(d)); });
      data.inputs = data.inputs.map(x=>({ ...x, name:redactPII(x.name||''), source:redactPII(x.source||'') }));
      data.outputs = data.outputs.map(x=>({ ...x, art:redactPII(x.art||''), consumer:redactPII(x.consumer||'') }));
      data.raci = data.raci.map(x=>({ ...x, party:redactPII(x.party||'') }));

      return data;
    }

    function computeReadiness(time){
      if(!time.length) return 0;
      const w = time.map(r=> (r.mins * (r.score||0)) );
      const totalMins = time.map(r=>r.mins).reduce((a,b)=>a+b,0) || 1;
      return Math.round( w.reduce((a,b)=>a+b,0) / totalMins );
    }

    function toMarkdown(data){
      const ready = computeReadiness(data.time);
      const hdr = `# –û—Ç—á—ë—Ç –ø–æ —Ä–æ–ª–∏: ${data.meta.role||''} ‚Äî ${data.meta.company||''}\n\n` +
                  `**–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** ${data.meta.dept||''}  \n` +
                  `**–î–∞—Ç–∞ –∏–Ω—Ç–µ—Ä–≤—å—é:** ${data.meta.date||''}  \n` +
                  `**–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä:** ${data.meta.interviewer||''}  \n` +
                  `**–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –∑–∞–ø–∏—Å—å:** ${data.meta.consentRecord?'–¥–∞':'–Ω–µ—Ç'}  \n` +
                  `**–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –ü–î:** ${data.meta.consentPII?'–¥–∞':'–Ω–µ—Ç'}  \n` +
                  `**–û—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:** ${ready}/100`;

      const tbl = (rows, heads)=>{
        if(!rows.length) return '';
        const head = `| ${heads.join(' | ')} |\n| ${heads.map(()=>'-').join(' | ')} |`;
        const body = rows.map(r=>`| ${heads.map((_,i)=> (r[i]??'').toString().replace(/\n/g,' ')).join(' | ')} |`).join('\n');
        return head + '\n' + body;
      };

      const md = [
        hdr,
        '\n\n## –ö–∞–Ω–∞–ª—ã –∏ —Å–∏—Å—Ç–µ–º—ã\n' + (data.channels||[]).map(c=>'- '+c).join('\n'),
        '\n\n## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n' + tbl( data.inputs.map(x=>[x.name,x.source,x.format,x.freq]), ['–ù–∞–∑–≤–∞–Ω–∏–µ','–ò—Å—Ç–æ—á–Ω–∏–∫','–§–æ—Ä–º–∞—Ç','–ß–∞—Å—Ç–æ—Ç–∞'] ),
        '\n\n## –í—ã—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã\n' + tbl( data.outputs.map(x=>[x.art,x.consumer,x.format,x.store]), ['–ê—Ä—Ç–µ—Ñ–∞–∫—Ç','–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å','–§–æ—Ä–º–∞—Ç','–•—Ä–∞–Ω–∏–ª–∏—â–µ'] ),
        '\n\n## –ó–∞–¥–∞—á–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã\n' + (data.tasks||[]).map((t,i)=>`### ${i+1}. ${t.title}\n- –¢—Ä–∏–≥–≥–µ—Ä: ${t.trigger}\n- –®–∞–≥–∏:\n${t.steps.map(s=>`  - ${s}`).join('\n')}\n- –†–∞–∑–≤–∏–ª–∫–∏:\n${t.decisions.map(s=>`  - ${s}`).join('\n')}\n- –ò—Å–∫–ª—é—á–µ–Ω–∏—è: ${t.exceptions||'-'}\n- SLA: ${t.sla||'-'}`).join('\n\n'),
        '\n\n## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ RACI\n' + tbl( data.raci.map(x=>[x.party,x.type,x.raci,x.channel]), ['–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç','–¢–∏–ø','RACI','–ö–∞–Ω–∞–ª'] ),
        '\n\n## –¢–∞–π–º-–∞—É–¥–∏—Ç\n' + tbl( data.time.map(x=>[x.task,x.freq,x.mins,x.score]), ['–ó–∞–¥–∞—á–∞','–ß–∞—Å—Ç–æ—Ç–∞','–ú–∏–Ω—É—Ç','–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ–º–æ—Å—Ç—å'] ),
        '\n\n## –ë–∏–∑–Ω–µ—Å‚Äë–ø—Ä–∞–≤–∏–ª–∞\n' + (data.rules||'-'),
        '\n\n## –†–∏—Å–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è\n' + (data.risks||'-'),
        '\n\n## –ú–µ—Ç—Ä–∏–∫–∏ / KPI\n' + (data.kpis||'-'),
        '\n\n## –î–æ—Å—Ç—É–ø—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n' + (data.security||'-'),
        '\n\n## –î–µ–Ω—å –∏–∑ –∂–∏–∑–Ω–∏\n' + (data.day||'-'),
        '\n\n## –ù–µ–¥–∞–≤–Ω–∏–µ –∫–µ–π—Å—ã\n' + (data.cases||'-'),
        '\n\n## –ò–¥–µ–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏\n' + (data.automation||'-'),
        '\n\n## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã\n' + (data.priorities||'-'),
      ].join('\n');
      return md;
    }

    function toYAML(data){
      // –ü—Ä–æ—Å—Ç–µ–π—à–∞—è YAML-—Å—Ö–µ–º–∞ –¥–ª—è agentic workflow
      const esc = s=> (s||'').toString().replace(/\n/g,'\\n').replace(/"/g,'\\"');
      const tasks = (data.tasks||[]).map(t=>`  - name: "${esc(t.title)}"\n    trigger: "${esc(t.trigger)}"\n    steps: [${t.steps.map(s=>'"'+esc(s)+'"').join(', ')}]\n    decisions: [${t.decisions.map(s=>'"'+esc(s)+'"').join(', ')}]\n    exceptions: "${esc(t.exceptions)}"\n    sla: "${esc(t.sla)}"`).join('\n');
      const inputs = (data.inputs||[]).map(x=>`  - name: "${esc(x.name)}"\n    source: "${esc(x.source)}"\n    format: "${esc(x.format)}"\n    frequency: "${esc(x.freq)}"`).join('\n');
      const outputs = (data.outputs||[]).map(x=>`  - name: "${esc(x.art)}"\n    consumer: "${esc(x.consumer)}"\n    format: "${esc(x.format)}"\n    storage: "${esc(x.store)}"`).join('\n');
      const raci = (data.raci||[]).map(x=>`  - party: "${esc(x.party)}"\n    interaction: "${esc(x.type)}"\n    role: "${esc(x.raci)}"\n    channel: "${esc(x.channel)}"`).join('\n');
      const time = (data.time||[]).map(x=>`  - task: "${esc(x.task)}"\n    frequency: "${esc(x.freq)}"\n    minutes: ${Number(x.mins)||0}\n    automatable: ${Number(x.score)||0}`).join('\n');
      const yaml = `spec: agentic-workflow-v0.1\nmeta:\n  company: "${esc(data.meta.company)}"\n  dept: "${esc(data.meta.dept)}"\n  role: "${esc(data.meta.role)}"\n  interview_date: "${esc(data.meta.date)}"\n  interviewer: "${esc(data.meta.interviewer)}"\nchannels:\n${inputs?('inputs:\n'+inputs):'inputs: []'}\n${outputs?('\noutputs:\n'+outputs):'\noutputs: []'}\nprocesses:\n${tasks||'  []'}\nraci:\n${raci||'  []'}\ntime_audit:\n${time||'  []'}\nrules: "${esc(data.rules)}"\nrisks: "${esc(data.risks)}"\nkpis: "${esc(data.kpis)}"\nsecurity: "${esc(data.security)}"\nday_in_life: "${esc(data.day)}"\nrecent_cases: "${esc(data.cases)}"\nautomation_ideas: "${esc(data.automation)}"\npriorities: "${esc(data.priorities)}"\n`;
      return yaml;
    }

    function exportAll(){
      const data = gather();
      const md = toMarkdown(data);
      const yml = toYAML(data);
      download('role-interview.json', JSON.stringify(data, null, 2));
      download('role-report.md', md);
      download('agentic-workflow.yml', yml);
    }

    function previewMarkdown(){
      const data = gather();
      qs('mdPreview').textContent = toMarkdown(data);
      qs('sec-preview').classList.remove('hidden');
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function download(filename, text){
      const blob = new Blob([text], {type: 'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.click();
      setTimeout(()=> URL.revokeObjectURL(url), 1000);
    }

    function saveDraft(){
      const data = gather();
      localStorage.setItem(SKEY, JSON.stringify(data));
      toast('–ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω.');
    }

    function loadDraft(){
      const raw = localStorage.getItem(SKEY); if(!raw){ toast('–ß–µ—Ä–Ω–æ–≤–∏–∫–∞ –Ω–µ—Ç.'); return; }
      applyData(JSON.parse(raw));
      toast('–ß–µ—Ä–Ω–æ–≤–∏–∫ –∑–∞–≥—Ä—É–∂–µ–Ω.');
    }

    function importJSON(ev){
      const f = ev.target.files[0]; if(!f) return;
      const rdr = new FileReader();
      rdr.onload = ()=>{ try{ const obj = JSON.parse(rdr.result); applyData(obj); toast('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ.'); }catch(e){ toast('–û—à–∏–±–∫–∞ JSON.'); } };
      rdr.readAsText(f);
    }

    function applyData(data){
      // –º–µ—Ç–∞
      ['company','dept','role','employee','interviewer','date'].forEach(id=>{ if(data.meta&&data.meta[id]!=null) qs(id).value = data.meta[id]; });
      if(data.meta){ qs('consentRecord').checked = !!data.meta.consentRecord; qs('consentPII').checked = !!data.meta.consentPII; qs('redact').checked = !!data.meta.redact; }

      // –∫–∞–Ω–∞–ª—ã
      qs('channelsBox').innerHTML='';
      (defaultChannels).forEach(c=> addChannelChip(c, data.channels?.includes(c)));
      (data.channels||[]).forEach(c=>{ if(!defaultChannels.includes(c)) addChannelChip(c, true); });

      // tables
      qs('inputsBody').innerHTML=''; (data.inputs||[]).forEach(r=>addRow('inputs', r));
      qs('outputsBody').innerHTML=''; (data.outputs||[]).forEach(r=>addRow('outputs', r));
      qs('raciBody').innerHTML=''; (data.raci||[]).forEach(r=>addRow('raci', r));
      qs('timeBody').innerHTML=''; (data.time||[]).forEach(r=>addRow('time', r)); recalcTime();

      // tasks
      qs('tasksBox').innerHTML=''; taskCount=0; (data.tasks||[]).forEach(t=>addTask(t));

      // text areas
      ['rules','risks','kpis','security','day','cases','automation','priorities'].forEach(id=>{ if(data[id]!=null) qs(id).value = data[id]; });

      rebuildDiagramSelector();
    }

    function toast(msg){
      const d = document.createElement('div');
      d.textContent = msg; d.className = 'fixed bottom-4 right-4 bg-black bg-opacity-80 text-white px-3 py-2 rounded-lg';
      document.body.appendChild(d); setTimeout(()=>d.remove(), 2500);
    }

    // ‚Äî –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî
    (function init(){
      defaultChannels.forEach(c=> addChannelChip(c));
      addRow('inputs'); addRow('outputs'); addRow('raci'); addRow('time');
      addTask({ title:'–û—Ç–≤–µ—Ç –Ω–∞ –≤—Ö–æ–¥—è—â–µ–µ –ø–∏—Å—å–º–æ –∫–ª–∏–µ–Ω—Ç–∞', trigger:'–ü–æ–ª—É—á–µ–Ω e‚Äëmail —Å –≤–æ–ø—Ä–æ—Å–æ–º', steps:'1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–∏—Å—å–º–æ\n2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ CRM\n3. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –ø–æ —à–∞–±–ª–æ–Ω—É', decisions:'–ï—Å—Ç—å –Ω–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞?\n–ï—Å—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Å—á–µ—Ç?' });
      recalcTime(); rebuildDiagramSelector();
    })();
  </script>
</body>
</html>
